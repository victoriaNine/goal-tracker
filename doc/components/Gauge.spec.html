<!DOCTYPE html><html lang="en"><head><title>components/Gauge.spec</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../"><meta name="groc-document-path" content="components/Gauge.spec"><meta name="groc-project-path" content="src/components/Gauge.spec.js"><link rel="stylesheet" type="text/css" media="all" href="../assets/style.css"><script type="text/javascript" src="../assets/behavior.js"></script><body><div id="meta"><div class="file-path">src/components/Gauge.spec.js</div></div><div id="document"><div class="segment"><div class="comments "><div class="wrapper"><h1 id="jauge-spec">Jauge (spec)</h1></div></div></div><div class="segment"><div class="code"><div class="wrapper"><span class="hljs-keyword">import</span> chai, { expect } <span class="hljs-keyword">from</span> <span class="hljs-string">'chai'</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p><a href="http://airbnb.io/enzyme/">Enzyme</a> est la super techno d’Airbnb pour tester
à toute bombe des composants React.  Elle dispose même d’un plugin Chai pour
avoir des assertions plus &quot;métier&quot;.</p></div></div><div class="code"><div class="wrapper"><span class="hljs-keyword">import</span> createChaiEnzyme <span class="hljs-keyword">from</span> <span class="hljs-string">'chai-enzyme'</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>On trouve également un sérialiseur dédié à Enzyme pour faire du
<a href="https://facebook.github.io/jest/docs/snapshot-testing.html#content">snapshot testing</a>
propre avec Jest.  Toutefois, pour utiliser ce dernier, il faut passer par les <em>matchers</em>
de Jest, et non ceux de Chai.  D’où cet import dédié, <code>jestExpect</code>.</p></div></div><div class="code"><div class="wrapper"><span class="hljs-keyword">import</span> enzymeToJSON <span class="hljs-keyword">from</span> <span class="hljs-string">'enzyme-to-json'</span>
<span class="hljs-keyword">import</span> jestExpect <span class="hljs-keyword">from</span> <span class="hljs-string">'jest-matchers'</span>

<span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Le mode “shallow” d’Enzyme est adapté à tout test qui ne nécessite pas le
DOM réel mais peut se contenter du DOM virtuel, ce qui inclue même les simulations
d’événement.</p></div></div><div class="code"><div class="wrapper"><span class="hljs-keyword">import</span> { shallow } <span class="hljs-keyword">from</span> <span class="hljs-string">'enzyme'</span>
<span class="hljs-keyword">import</span> sinon <span class="hljs-keyword">from</span> <span class="hljs-string">'sinon'</span>

<span class="hljs-keyword">import</span> Gauge <span class="hljs-keyword">from</span> <span class="hljs-string">'../../src/components/Gauge'</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Mise en place du plugin Chai d’Enzyme</p></div></div><div class="code"><div class="wrapper">chai.use(createChaiEnzyme())</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Classiquement, quand on décrit un composant React, on utilise sa balise JSX
comme sujet de la description.  Celui-ci est censé…</p></div></div><div class="code"><div class="wrapper">describe(<span class="hljs-string">'&lt;Gauge /&gt;'</span>, () =&gt; {</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><h2 id="produire-le-composant-attendu">…produire le composant attendu</h2></div></div></div><div class="segment"><div class="code"><div class="wrapper">  it(<span class="hljs-string">'should render appropriately'</span>, () =&gt; {</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Hop!  Production de l’enrobage de test à base de DOM virtuel pour notre composant.</p></div></div><div class="code"><div class="wrapper">    <span class="hljs-keyword">const</span> wrapper = shallow(<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-title">Gauge</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">{50}</span> /&gt;</span>)</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Utilisation d’une assertion métier du plugin: <code>prop</code>, qui teste la présence, voire
la valeur, d’une <em>prop</em> au sens React.</p></div></div><div class="code"><div class="wrapper">    expect(wrapper).to.have.prop(<span class="hljs-string">'mode'</span>, <span class="hljs-string">'determinate'</span>)
    expect(wrapper).to.have.prop(<span class="hljs-string">'max'</span>, <span class="hljs-number">100</span>)
    expect(wrapper).to.have.prop(<span class="hljs-string">'value'</span>, <span class="hljs-number">50</span>)</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Comme les assertions de valeur de <em>prop</em> sont de simples égalités strictes
(<code>===</code>), elles ne suffisent pas pour des objets.  On récupère alors la valeur
directement auprès de l&#39;enrobage de test (<code>.prop(…)</code>) et on utilise une comparaison
profonde standard de Chai.</p></div></div><div class="code"><div class="wrapper">    expect(wrapper.prop(<span class="hljs-string">'style'</span>)).to.deep.equal({ height: <span class="hljs-number">8</span> })
  })</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><h2 id="-g-rer-sa-prop-optionnelle-max-">…gérer sa <em>prop</em> optionnelle <code>max</code></h2></div></div><div class="code"><div class="wrapper">  it(<span class="hljs-string">'should honor custom max'</span>, () =&gt; {
    <span class="hljs-keyword">const</span> wrapper = shallow(<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-title">Gauge</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">{50}</span> <span class="hljs-attribute">max</span>=<span class="hljs-value">{75}</span> /&gt;</span>)</span>

    expect(wrapper).to.have.prop(<span class="hljs-string">'max'</span>, <span class="hljs-number">75</span>)
  })</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><h2 id="valider-le-snapshot">…valider le snapshot</h2>
<p>(avoir une structure détaillée identique à la dernière qui a été validée
par les développeurs au moyen d’un snapshot.)</p></div></div><div class="code"><div class="wrapper">  it(<span class="hljs-string">'should otherwise match the expected snapshot'</span>, () =&gt; {
    <span class="hljs-keyword">const</span> mock = sinon.useFakeTimers()
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> wrapper = shallow(<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-title">Gauge</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">{50}</span> /&gt;</span>)</span>

      jestExpect(enzymeToJSON(wrapper)).toMatchSnapshot()
    } <span class="hljs-keyword">finally</span> {
      mock.restore()
    }
  })
})</div></div></div></div></body></html>