<!DOCTYPE html><html lang="en"><head><title>prop-types</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content=""><meta name="groc-document-path" content="prop-types"><meta name="groc-project-path" content="src/prop-types.js"><link rel="stylesheet" type="text/css" media="all" href="assets/style.css"><script type="text/javascript" src="assets/behavior.js"></script><body><div id="meta"><div class="file-path">src/prop-types.js</div></div><div id="document"><div class="segment"><div class="comments "><div class="wrapper"><h1 id="types-complexes-de-proprits-react">Types complexes de propriétés React</h1></div></div></div><div class="segment"><div class="code"><div class="wrapper"><span class="hljs-keyword">import</span> {
  and,
  between,
  integer,
  keysOf,
  nonNegativeInteger
} <span class="hljs-keyword">from</span> <span class="hljs-string">'airbnb-prop-types'</span>
<span class="hljs-keyword">import</span> { PropTypes } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Les composants React peuvent déclarer
<a href="http://facebook.github.io/react/docs/reusable-components.html">le type et la structure des propriétés</a>
qui leur sont passées,
pour bénéficier d’une aide à la validation affichée
généralement sous forme d’erreurs dans la console du
navigateur.</p>
<p>Outre les types prédéfinis, il est possible de déclarer
des types complexes, avec des objets, des tableaux, etc.
Lorsqu&#39;ils sont répétés à travers le code, autant les
centraliser, comme ici.</p></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>On ré-exporte le <code>nonNegativeInteger</code> d’Airbnb, comme ça le reste
du code de l’appli n’a pas à se soucier de l’origine des validateurs
avancés (Airbnb ou nous) : il importe depuis ce module à tous les coups.</p></div></div><div class="code"><div class="wrapper"><span class="hljs-keyword">export</span> { nonNegativeInteger }</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Validateur d’entier positif non nul (ex. valeurs d’objectifs).
Airbnb fournit <code>nonNegativeInteger</code>, mais pas la version sans le zéro…</p></div></div><div class="code"><div class="wrapper"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> positiveInteger = and([integer(), between({ gt: <span class="hljs-number">0</span> })])</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Description d’un objectif, utilisé dans de nombreux composants.</p></div></div><div class="code"><div class="wrapper"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> GoalPropType = PropTypes.shape({
  id: nonNegativeInteger.isRequired,
  name: PropTypes.string.isRequired,
  target: positiveInteger.isRequired,
  units: PropTypes.string.isRequired
})</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Validateur interne, utilisé pour les clés de <code>stats[n].progresses</code>
dans <code>HistoryDayStatsType</code> plus bas, qui s’assure qu’une donnée est
une <code>String</code> représentant un entier positif ou nul (dans notre cas, un ID
d’objectif).  Utilisé comme validateur interne de <code>keysOf(…)</code> plus bas.</p></div></div><div class="code"><div class="wrapper"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">nonNegativeIntegerString</span> (<span class="hljs-params">props, propName, componentName</span>) </span>{
  <span class="hljs-keyword">const</span> value = props[propName]
  <span class="hljs-keyword">const</span> numberValue = <span class="hljs-built_in">Number</span>(value)

  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> value !== <span class="hljs-string">'string'</span> || !<span class="hljs-built_in">Number</span>.isInteger(numberValue) || numberValue &lt; <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">`<span class="hljs-subst">${propName}</span> in <span class="hljs-subst">${componentName}</span> must be a string representing a non-negative integer`</span>)
  }

  <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>
}</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Base &quot;champ requis&quot; du validateur pour les champs <code>progresses</code> des journées
d’historique.  Sera exposé sous la version <code>isRequired</code> d’un enrobage qui lève
cette exigence en vérifiant <code>null</code> et <code>undefined</code> (voir ci-après).</p></div></div><div class="code"><div class="wrapper"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">requiredHistoryDayProgressesPropType</span> (<span class="hljs-params">props, propName, componentName</span>) </span>{
  <span class="hljs-keyword">const</span> prefix = <span class="hljs-string">`<span class="hljs-subst">${propName}</span> in <span class="hljs-subst">${componentName}</span> must`</span>
  <span class="hljs-keyword">const</span> value = props[propName]</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><ol>
<li>Le champ doit être un tableau</li>
</ol></div></div><div class="code"><div class="wrapper">  <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">Array</span>.isArray(value)) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">`<span class="hljs-subst">${prefix}</span> be an array.`</span>)
  }</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><ol>
<li>Il doit contenir une paire de véritables nombres entiers</li>
</ol></div></div><div class="code"><div class="wrapper">  <span class="hljs-keyword">if</span> (value.length !== <span class="hljs-number">2</span> || !value.every(<span class="hljs-built_in">Number</span>.isInteger)) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">`<span class="hljs-subst">${prefix}</span> be a pair of integers.`</span>)
  }

  <span class="hljs-keyword">const</span> [progress, target] = value</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><ol>
<li>La valeur de progression ne peut être négative</li>
</ol></div></div><div class="code"><div class="wrapper">  <span class="hljs-keyword">if</span> (progress &lt; <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">`<span class="hljs-subst">${prefix}</span> start with a non-negative progress value.`</span>)
  }</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><ol>
<li>La valeur cible dénormalisée de l&#39;objectif ne peut être
négative ou nulle.</li>
</ol></div></div><div class="code"><div class="wrapper">  <span class="hljs-keyword">if</span> (target &lt;= <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">`<span class="hljs-subst">${prefix}</span> end with a positive target value.`</span>)
  }</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Bon, bah tout va bien alors…</p></div></div><div class="code"><div class="wrapper">  <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>
}</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Validateur exporté, en mode &quot;non requis&quot; pour coller aux conventions des
<code>React.PropTypes</code>.  Lève en fait l’exigence de présence du code noyau en
court-circuitant les cas <code>null</code> et <code>undefined</code> (d’où le <code>==</code> laxiste).</p></div></div><div class="code"><div class="wrapper"><span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">HistoryDayProgressesPropType</span> (<span class="hljs-params">props, propName, componentName</span>) </span>{
  <span class="hljs-keyword">const</span> value = props[propName]

  <span class="hljs-keyword">if</span> (value == <span class="hljs-literal">null</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>
  }

  <span class="hljs-keyword">return</span> requiredHistoryDayProgressesPropType(props, propName, componentName)
}</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Exposition du validateur noyau, qui exige le champ, sous la propriété chaînée
<code>isRequired</code> habituelle.</p></div></div><div class="code"><div class="wrapper">HistoryDayProgressesPropType.isRequired = requiredHistoryDayProgressesPropType</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Description d’un jour de stats dans l’historique.</p></div></div><div class="code"><div class="wrapper"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> HistoryDayStatsPropType = PropTypes.shape({
  date: PropTypes.string.isRequired,
  progresses: and([</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Exigence sur les clés : IDs d’objectifs, donc chaînes représentant des
entiers non négatifs.  Le validateur interne est à nous (vois plus haut).</p></div></div><div class="code"><div class="wrapper">    keysOf(nonNegativeIntegerString),</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Exigence sur les valeurs : paires d’entiers avec contraintes supplémentaires</p></div></div><div class="code"><div class="wrapper">    PropTypes.objectOf(HistoryDayProgressesPropType)
  ]).isRequired
})</div></div></div></div></body></html>